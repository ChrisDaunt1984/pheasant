{%- macro output_text(output) -%}
  {%- if output.type == 'execute_result' -%}
    {%- if 'text/html' not in output.data -%}
      {{ output.data['text/plain']|e }}
    {%- endif -%}
  {%- elif output.type == 'stream' and output.name != 'stderr' -%}
    {%- if output.text[-1] == '\n' -%}
      {{ output.text[:-1]|e }}
    {%- else -%}
      {{ output.text|e }}
    {%- endif -%}
  {%- elif output.type == 'error' -%}
    {{ output.traceback[-1]|e }}
  {%- endif -%}
{%- endmacro -%}


{%- macro data_png(output) -%}
<p><img alt="png" src="data:image/png;base64,{{ output.data['image/png'].replace('\n', '') }}" /></p>
{%- endmacro -%}

{%- macro data_html(output) -%}
{{ output.data['text/html'] }}
{%- endmacro -%}

{%- macro data_plain(output) -%}
{{ output.data['text/plain'] }}
{%- endmacro -%}

{%- macro data_latex(output) -%}
{{ output.data['text/latex'] }}
{%- endmacro -%}

{%- macro output_display(output, display) -%}
  {%- if display -%}
  <div class="pheasant-jupyter-display">{{"\n"}}
  {%- endif -%}
  {%- if output.type == 'error' -%}
    {{ output.traceback[-1] }}
  {%- endif -%}
  {%- for type in output.data -%}
    {%- if type == 'application/pdf' -%}
        {%- block data_pdf -%}{%- endblock -%}
    {%- elif type == 'image/svg+xml' -%}
        {%- block data_svg -%}{%- endblock -%}
    {%- elif type == 'image/png' -%}
        {{ data_png(output) }}
    {%- elif type == 'text/html' -%}
        {{ data_html(output) }}
    {%- elif type == 'text/markdown' -%}
        {%- block data_markdown -%}{%- endblock -%}
    {%- elif type == 'image/jpeg' -%}
        {%- block data_jpg -%}{%- endblock -%}
    {%- elif type == 'text/plain' -%}
        {{ data_plain(output) }}
    {%- elif type == 'text/latex' -%}
        {{ data_latex(output) }}
    {%- elif type == 'application/javascript' -%}
        {%- block data_javascript -%}{%- endblock -%}
    {%- elif type == 'application/vnd.jupyter.widget-state+json' -%}
        {%- block data_widget_state -%}{%- endblock -%}
    {%- elif type == 'application/vnd.jupyter.widget-view+json' -%}
        {%- block data_widget_view -%}{%- endblock -%}
    {%- else -%}
        {%- block data_other -%}{%- endblock -%}
    {%- endif -%}
  {%- endfor -%}
  {%- if display -%}
    </div>{{"\n"}}
  {%- endif -%}
{%- endmacro -%}
